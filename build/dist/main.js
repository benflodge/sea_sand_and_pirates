!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";n.r(e);Math.PI;var i=Math.PI/2,a=Math.PI+i,o={PORT:i,STARBOARD:a},h=(Object.keys(o),["compass-arrow","sea-sand","canvas","map-canvas","matrix-svg","audio-control","music-control","audio-control-audio-off","audio-control-audio-on","audio-control-music-off","audio-control-music-on","help","help-popup","help-close","start-game-button","ui-controls"]),r=function(t,e){return e.addEventListener?function(e,n,i){if(e&&!e.length||e===t)e.addEventListener(n,i,!1);else if(e&&e.length)for(var a=e.length,o=0;o<a;o++)r(e[o],n,i)}:e.attachEvent?function(e,n,i){if(e&&!e.length||e===t)e.attachEvent("on"+n,(function(){return i.call(e,t.event)}));else if(e.length)for(var a=e.length,o=0;o<a;o++)r(e[o],n,i)}:void 0}(void 0,document),s={37:"left",38:"up",39:"right",40:"down"};function l(t){return s[t]||String.fromCharCode(t).toLowerCase()}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t){return 0|t}function c(t,e){return t=Math.ceil(t),e=d(e),d(Math.random()*(e-t))+t}function p(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;return{x:d(t/n),y:d(e/n)}}function g(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;return{x:d(t)*n,y:d(e)*n}}function f(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=p(e,n,i);return!t[a.y]||1!==t[a.y][a.x]}function y(t,e,n){return t<e?e:t>n?n:t}function m(t,e){return Math.atan2(e.position[1]-t.position[1],e.position[0]-t.position[0])}function w(t,e){var n=e-t;return n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI),n}function v(t){for(var e=!0,n=0;n<t.length&&(e=u(arguments[n+1])===t[n]);n++);return e}var b={x:0,y:0,isInViewport:function(t,e,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:200;return t>-this.x-a&&t<-this.x+n+a&&e>-this.y-a&&e<-this.y+i+a},calculateX:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;return y(e/2-t,e-n-i,i)},calculateY:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;return y(e/2-t,e-n-i,i)},setX:function(t,e,n){this.x=d(this.calculateX(t,e,n))},setY:function(t,e,n){this.y=d(this.calculateY(t,e,n))}};function x(t){var e;this[(e=t,e.replace(/(-\w)/g,(function(t){return t[1].toUpperCase()})))]=document.getElementById(t)}var S=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.forEach(x,e),e},C=window.AudioContext||window.webkitAudioContext,L={audioEnabled:!0,create:function(t){var e=Object.create(this);return e.audioContext=new C,e.audioFiles=t,e.loadSounds(t),e.gainNode=e.audioContext.createGain(),e},loadSounds:function(t){var e=this;Object.keys(t).forEach((function(n){return e.loadSound(t,n)}))},loadSound:function(t,e){var n=this,i=new XMLHttpRequest;i.open("GET",t[e].src,!0),i.responseType="arraybuffer",i.onload=function(){n.audioContext.decodeAudioData(i.response,(function(n){t[e].sound=n}),console.error)},i.send()},playSound:function(t){if(this.audioEnabled){"suspended"===this.audioContext.state&&this.audioContext.resume();var e=this.audioContext.createBufferSource();return e.buffer=t,e.connect(this.audioContext.destination),e.start(0),e}},getSoundBuffer:function(t){return this.audioFiles&&this.audioFiles[t]&&this.audioFiles[t].sound},enableSound:function(){!1===this.audioEnabled&&(this.audioContext.resume(),this.audioEnabled=!0)},disableSound:function(){!0===this.audioEnabled&&(this.audioContext.suspend(),this.audioEnabled=!1)},isEnabled:function(){return this.audioEnabled}},P={cannon1:{src:"./assets/audio/cannons/cannon-1.mp3",sound:null},cannon2:{src:"./assets/audio/cannons/cannon-2.mp3",sound:null},cannon3:{src:"./assets/audio/cannons/cannon-3.mp3",sound:null},cannon4:{src:"./assets/audio/cannons/cannon-4.mp3",sound:null},cannon5:{src:"./assets/audio/cannons/cannon-5.mp3",sound:null},cannon6:{src:"./assets/audio/cannons/cannon-6.mp3",sound:null},cannon7:{src:"./assets/audio/cannons/cannon-7.mp3",sound:null}},T={create:function(){var t=Object.create(this);return t.audio=L.create(P),t},playCannonSound:function(){if(this.audio.isEnabled()){var t=c(1,8),e=this.audio.getSoundBuffer("cannon".concat(t));e&&this.audio.playSound(e)}}},A={};function M(){r(document.body,"keydown",(function(t){!function(t,e){var n=(t=t||window.event).charCode||t.keyCode;if(t.preventDefault(),n)e[l(n)]=!0}(t,A)})),r(document.body,"keyup",(function(t){!function(t,e){var n=(t=t||window.event).charCode||t.keyCode;if(n)e[l(n)]=!1}(t,A)}))}function O(t){r(t.uiElements.uiControls,"click",(function(e){switch(e.target.parentElement){case t.uiElements.audioControl:!function(t){var e=t.sfx.audio.isEnabled();e?t.sfx.audio.disableSound():t.sfx.audio.enableSound(),E(t,!e,"Audio")}(t);break;case t.uiElements.musicControl:!function(t){var e=t.music.audio.isEnabled();e?t.music.audio.disableSound():t.music.audio.enableSound(),E(t,!e,"Music")}(t);break;case t.uiElements.help:t.uiElements.helpPopup.classList.toggle("hidden"),t.currentGame.stop()}}))}function E(t,e,n){e?(t.uiElements["audioControl".concat(n,"Off")].classList.add("hidden"),t.uiElements["audioControl".concat(n,"On")].classList.remove("hidden")):(t.uiElements["audioControl".concat(n,"Off")].classList.remove("hidden"),t.uiElements["audioControl".concat(n,"On")].classList.add("hidden"))}var k=null;function B(t){if(this.running){window.requestAnimationFrame(this.gameLoop),t||(t=0);var e=this.previous?(t-this.previous)/1e3:0;this.update(this.view,this.frameDuration,e,this.maxSubSteps,t),this.draw(this.view,t),this.previous=t}}var I={maxSubSteps:10,frameDuration:1/30},j={update:null,draw:null,view:null,running:!1,previous:0,lag:0,create:function(t,e,n){if(!v(["object","function","function"],t,e,n))return null;var i=Object.create(this);return i.gameLoop=B.bind(i),Object.assign(i,I,{view:t,update:e,draw:n}),i},run:function(){return!k&&(this.running=!0,k=this,this.gameLoop(),!0)},stop:function(){this.running=!1,this.previous=null,k=null}},R={imagePath:"shipsMiscellaneous_sheet.png",SubTexture:[{name:"cannon.png",x:"88",y:"422",width:"29",height:"16"},{name:"cannonBall.png",x:"120",y:"29",width:"10",height:"10"},{name:"cannonLoose.png",x:"439",y:"496",width:"20",height:"12"},{name:"cannonMobile.png",x:"408",y:"489",width:"29",height:"20"},{name:"crew (1).png",x:"511",y:"489",width:"22",height:"20"},{name:"crew (2).png",x:"463",y:"489",width:"22",height:"20"},{name:"crew (3).png",x:"487",y:"489",width:"22",height:"20"},{name:"crew (4).png",x:"568",y:"469",width:"22",height:"22"},{name:"crew (5).png",x:"439",y:"472",width:"22",height:"22"},{name:"crew (6).png",x:"544",y:"469",width:"22",height:"22"},{name:"dinghyLarge1.png",x:"606",y:"145",width:"20",height:"38"},{name:"dinghyLarge2.png",x:"610",y:"426",width:"20",height:"38"},{name:"dinghyLarge3.png",x:"588",y:"426",width:"20",height:"38"},{name:"dinghySmall1.png",x:"628",y:"166",width:"16",height:"26"},{name:"dinghySmall2.png",x:"612",y:"110",width:"16",height:"26"},{name:"dinghySmall3.png",x:"628",y:"138",width:"16",height:"26"},{name:"explosion1.png",x:"0",y:"0",width:"74",height:"75"},{name:"explosion2.png",x:"544",y:"145",width:"60",height:"59"},{name:"explosion3.png",x:"544",y:"426",width:"42",height:"41"},{name:"fire1.png",x:"614",y:"466",width:"18",height:"39"},{name:"fire2.png",x:"120",y:"0",width:"11",height:"27"},{name:"flag (1).png",x:"120",y:"41",width:"6",height:"22"},{name:"flag (2).png",x:"600",y:"486",width:"6",height:"22"},{name:"flag (3).png",x:"630",y:"110",width:"6",height:"22"},{name:"flag (4).png",x:"128",y:"41",width:"6",height:"22"},{name:"flag (5).png",x:"592",y:"486",width:"6",height:"22"},{name:"flag (6).png",x:"632",y:"426",width:"6",height:"22"},{name:"hullLarge (1).png",x:"596",y:"316",width:"50",height:"108"},{name:"hullLarge (2).png",x:"544",y:"206",width:"50",height:"108"},{name:"hullLarge (3).png",x:"596",y:"206",width:"50",height:"108"},{name:"hullLarge (4).png",x:"544",y:"316",width:"50",height:"108"},{name:"hullSmall (1).png",x:"612",y:"0",width:"40",height:"108"},{name:"hullSmall (2).png",x:"648",y:"330",width:"40",height:"108"},{name:"hullSmall (3).png",x:"648",y:"110",width:"40",height:"108"},{name:"hullSmall (4).png",x:"648",y:"220",width:"40",height:"108"},{name:"nest.png",x:"592",y:"466",width:"20",height:"18"},{name:"pole.png",x:"119",y:"422",width:"12",height:"11"},{name:"sailLarge (1).png",x:"408",y:"279",width:"66",height:"47"},{name:"sailLarge (10).png",x:"408",y:"328",width:"66",height:"46"},{name:"sailLarge (11).png",x:"408",y:"376",width:"66",height:"46"},{name:"sailLarge (12).png",x:"408",y:"424",width:"66",height:"46"},{name:"sailLarge (13).png",x:"476",y:"0",width:"66",height:"47"},{name:"sailLarge (14).png",x:"476",y:"49",width:"66",height:"47"},{name:"sailLarge (15).png",x:"136",y:"460",width:"66",height:"47"},{name:"sailLarge (16).png",x:"68",y:"460",width:"66",height:"47"},{name:"sailLarge (17).png",x:"476",y:"98",width:"66",height:"47"},{name:"sailLarge (18).png",x:"476",y:"147",width:"66",height:"47"},{name:"sailLarge (19).png",x:"476",y:"293",width:"66",height:"47"},{name:"sailLarge (2).png",x:"272",y:"460",width:"66",height:"47"},{name:"sailLarge (20).png",x:"204",y:"460",width:"66",height:"47"},{name:"sailLarge (21).png",x:"340",y:"460",width:"66",height:"47"},{name:"sailLarge (22).png",x:"476",y:"244",width:"66",height:"47"},{name:"sailLarge (23).png",x:"408",y:"230",width:"66",height:"47"},{name:"sailLarge (24).png",x:"476",y:"342",width:"66",height:"47"},{name:"sailLarge (3).png",x:"476",y:"391",width:"66",height:"47"},{name:"sailLarge (4).png",x:"476",y:"440",width:"66",height:"47"},{name:"sailLarge (5).png",x:"544",y:"0",width:"66",height:"47"},{name:"sailLarge (6).png",x:"0",y:"460",width:"66",height:"47"},{name:"sailLarge (7).png",x:"476",y:"196",width:"66",height:"46"},{name:"sailLarge (8).png",x:"544",y:"97",width:"66",height:"46"},{name:"sailLarge (9).png",x:"544",y:"49",width:"66",height:"46"},{name:"sailSmall (1).png",x:"0",y:"422",width:"42",height:"9"},{name:"sailSmall (10).png",x:"44",y:"422",width:"42",height:"9"},{name:"sailSmall (11).png",x:"0",y:"433",width:"42",height:"9"},{name:"sailSmall (12).png",x:"44",y:"433",width:"42",height:"9"},{name:"sailSmall (13).png",x:"44",y:"444",width:"42",height:"9"},{name:"sailSmall (2).png",x:"0",y:"444",width:"42",height:"9"},{name:"sailSmall (3).png",x:"76",y:"0",width:"42",height:"8"},{name:"sailSmall (4).png",x:"76",y:"10",width:"42",height:"8"},{name:"sailSmall (5).png",x:"76",y:"20",width:"42",height:"8"},{name:"sailSmall (6).png",x:"76",y:"30",width:"42",height:"8"},{name:"sailSmall (7).png",x:"76",y:"40",width:"42",height:"9"},{name:"sailSmall (8).png",x:"76",y:"62",width:"42",height:"9"},{name:"sailSmall (9).png",x:"76",y:"51",width:"42",height:"9"},{name:"ship (1).png",x:"408",y:"0",width:"66",height:"113"},{name:"ship (10).png",x:"340",y:"345",width:"66",height:"113"},{name:"ship (11).png",x:"340",y:"230",width:"66",height:"113"},{name:"ship (12).png",x:"340",y:"115",width:"66",height:"113"},{name:"ship (13).png",x:"340",y:"0",width:"66",height:"113"},{name:"ship (14).png",x:"272",y:"345",width:"66",height:"113"},{name:"ship (15).png",x:"272",y:"230",width:"66",height:"113"},{name:"ship (16).png",x:"272",y:"115",width:"66",height:"113"},{name:"ship (17).png",x:"272",y:"0",width:"66",height:"113"},{name:"ship (18).png",x:"204",y:"345",width:"66",height:"113"},{name:"ship (19).png",x:"204",y:"230",width:"66",height:"113"},{name:"ship (2).png",x:"408",y:"115",width:"66",height:"113"},{name:"ship (20).png",x:"204",y:"0",width:"66",height:"113"},{name:"ship (21).png",x:"136",y:"345",width:"66",height:"113"},{name:"ship (22).png",x:"136",y:"230",width:"66",height:"113"},{name:"ship (23).png",x:"136",y:"115",width:"66",height:"113"},{name:"ship (24).png",x:"136",y:"0",width:"66",height:"113"},{name:"ship (3).png",x:"204",y:"115",width:"66",height:"113"},{name:"ship (4).png",x:"68",y:"192",width:"66",height:"113"},{name:"ship (5).png",x:"68",y:"77",width:"66",height:"113"},{name:"ship (6).png",x:"68",y:"307",width:"66",height:"113"},{name:"ship (7).png",x:"0",y:"192",width:"66",height:"113"},{name:"ship (8).png",x:"0",y:"307",width:"66",height:"113"},{name:"ship (9).png",x:"0",y:"77",width:"66",height:"113"},{name:"wood (1).png",x:"88",y:"449",width:"15",height:"7"},{name:"wood (2).png",x:"408",y:"472",width:"26",height:"10"},{name:"wood (3).png",x:"116",y:"440",width:"15",height:"10"},{name:"wood (4).png",x:"88",y:"440",width:"26",height:"7"}]},V="SHIP",X={cannonSpeed:600,speed:60,hull:300,shipImageTile:91},Y={firing:!1,type:V,create:function(t,e,n,i){var a=t.game;if(!v(["object","number","number"],t,e,n))return null;var o=Object.create(this);Object.assign(o,X,i),o.active=!0,o.view=t;var h=new p2.Circle({radius:1});return o.body=new p2.Body({mass:30,damping:.3,angularDamping:0,position:[e/32,n/32]}),o.body.parent=o,o.body.addShape(h),a.physics.world.addBody(o.body),o},fireStarboard:function(t){this.fire(t,"STARBOARD")},firePort:function(t){this.fire(t,"PORT")},fire:function(t,e){if(!this.firing){this.firing=!0;var n={xVel:this.getXVel(),yVel:this.getYVel(),angle:this.getAngle()+o[e],parent:this};t.add(this.view,this.getX(),this.getY(),n),window.setTimeout(this.fireFinished.bind(this),this.cannonSpeed)}},fireFinished:function(){this.firing=!1},damageHull:function(t,e){this.hull-="number"==typeof e?e:100,this.hull<=0&&this.setActive(t,!1)},draw:function(t,e){if(this.isActive()){var n=t.context,i=this.findRenderPoint();if(n.save(),n.beginPath(),n.translate(d(32*i[0]+t.viewport.x),d(32*i[1]+t.viewport.y)),n.rotate(this.getAngle()),n.drawImage(e,R.SubTexture[this.shipImageTile].x,R.SubTexture[this.shipImageTile].y,R.SubTexture[this.shipImageTile].width,R.SubTexture[this.shipImageTile].height,-30,-50,60,100),window.debug&&(n.beginPath(),n.arc(0,0,32,0,2*Math.PI),n.stroke(),n.arc(0,0,192,0,2*Math.PI),n.stroke()),n.restore(),window.debug){if(this.path)for(var a=0;a<this.path.length;a++){var o=this.path[a];t.mapContext.save(),t.mapContext.translate(o[0],o[1]),t.mapContext.fillStyle="orange",t.mapContext.fillRect(0,0,2,2),t.mapContext.restore()}if(this.path)for(var h=0;h<this.path.length;h++){var r=this.path[h],s=g(r[0],r[1]);n.save(),n.translate(s.x+16+t.viewport.x,s.y+16+t.viewport.y),n.fillStyle="orange",n.fillRect(0,0,4,4),n.restore()}}}},findRenderPoint:function(){return this.body?this.body.interpolatedPosition:null},findRenderX:function(){return this.body?this.body.interpolatedPosition[0]:null},findRenderY:function(){return this.body?this.body.interpolatedPosition[1]:null},getX:function(){return this.body?this.body.position[0]:null},getY:function(){return this.body?this.body.position[1]:null},getXVel:function(){return this.body?this.body.velocity[0]:null},getYVel:function(){return this.body?this.body.velocity[1]:null},getRenderAngle:function(){return this.body.interpolatedAngle},getAngle:function(){return this.body?this.body.angle:null},setActive:function(t,e){var n=t.game;"boolean"==typeof e&&(this.active=e,e||(n.physics.removeBodies.push(this.body),this.body.parent=null,this.body=null))},isActive:function(){return this.active}},F={parent:null,dieTime:null,type:"CANNON_BALL",create:function(t,e,n,i){if(!v(["object","number","number"],t,e,n))return null;var a=Object.create(this);return a?this.setProps(a,t,e,n,i):null},reset:function(t,e,n,i){return this.body?null:this.setProps(this,t,e,n,i)},setProps:function(t,e,n,i,a){var o=e.game,h=a.xVel,r=a.yVel,s=a.parent,l=a.angle;if(!v(["number","number","number","object"],h,r,l,s))return null;l+=Math.PI/2,t.parent=s,t.active=!0,t.dieTime=o.physics.world.time+1.4,t.body=new p2.Body({mass:4,damping:.3,angularDamping:0,position:[1*Math.cos(l)+n,1*Math.sin(l)+i],velocity:[6*Math.cos(l)+h,6*Math.sin(l)+r]});var u=new p2.Circle({radius:.1});return t.body.parent=t,t.body.addShape(u),o.physics.world.addBody(t.body),e.sfx.playCannonSound(e),t},update:function(t){var e=t.game;this.isActive()&&this.dieTime<=e.physics.world.time&&this.setActive(t,!1)},setActive:function(t,e){var n=t.game;"boolean"==typeof e&&(this.active=e,e||(n.physics.removeBodies.push(this.body),this.body.parent=null,this.body=null))},isActive:function(){return this.active},findRenderPoint:function(){return this.body?this.body.interpolatedPosition:null},findRenderX:function(){return this.body?this.body.interpolatedPosition[0]:null},findRenderY:function(){return this.body?this.body.interpolatedPosition[1]:null},getX:function(){return this.body?this.body.position[0]:null},getY:function(){return this.body?this.body.position[1]:null},getAngle:function(){return this.body?this.body.interpolatedAngle:null},draw:function(t,e){this.isActive()&&t.context.drawImage(e.pirateShips,R.SubTexture[1].x,R.SubTexture[1].y,R.SubTexture[1].width,R.SubTexture[1].height,d(32*this.getX()+t.viewport.x),d(32*this.getY()+t.viewport.y),10,10)}};function D(t){var e=t.game;e.map=function(t,e){window.noise.seed();for(var n=[],i=0;i<t;i+=32){var a=[];n.push(a);for(var o=0;o<e;o+=32){var h=window.noise.perlin2(.0016*i,.0016*o);h>.4?a.push(1):h>.32?a.push(99):a.push(null)}}return n}(4e3,4e3),e.mapForImages=e.map.map((function(t){return t.map((function(t){return 1===t?0:null}))})),e.tileMapValues=function(t){return t.map((function(e,n){return e.map((function(i,a){return null===i||0!==i?null:function(t,e,n){return t[e-1]&&0===t[e-1][n]?1:0}(t,n,a)|function(t,e){return 0===t[e+1]?4:0}(e,a)|function(t,e,n){return t[e+1]&&0===t[e+1][n]?8:0}(t,n,a)|function(t,e){return 0===t[e-1]?2:0}(e,a)}))}))}(e.mapForImages),e.aStarGraph=new PF.Grid(e.map),function(t,e){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){if("number"==typeof t[n][i]){var a=new p2.Box({width:1,height:1}),o=new p2.Body({mass:0,position:[i,n]});o.addShape(a),o.parent={type:"wall"},e.addBody(o)}}}(e.tileMapValues,e.physics.world)}function G(t){var e=null;switch(t){case 3:e=[2,2];break;case 5:e=[0,2];break;case 7:e=[1,2];break;case 10:e=[2,0];break;case 11:e=[2,1];break;case 12:e=[0,0];break;case 13:e=[0,1];break;case 14:e=[1,0];break;case 15:e=[3,4];break;default:e=[1,4]}return e}function H(t,e){e.isActive()&&(t.save(),t.translate(d(e.getX()),d(e.getY())),t.fillStyle=e.color||"black",t.fillRect(0,0,2,2),t.restore())}function _(t){var e=t.game.physics={};e.removeBodies=[],e.world=new p2.World({gravity:[0,0]}),e.world.defaultContactMaterial.friction=0,e.world.applyGravity=!1,e.world.on("postStep",(function(){return function(t){var e=t.game;e.actors.enemyShips.forEach((function(n){n.makeMove(t,e.actors.playerShip,e.physics.timeStamp,e.actors.cannonBalls,e.aStarGraph)})),e.actors.playerShip.makeMove(t,e)}(t)})),e.world.on("beginContact",(function(e){return function(t,e){var n=t.bodyA.parent,i=t.bodyB.parent;if(!n||!i)return;n.type===V&&i.type===V?(n.damageHull(e,20),i.damageHull(e,20)):n.type===V&&"CANNON_BALL"===i.type&&i.parent!==n?n.damageHull(e):i.type===V&&"CANNON_BALL"===n.type&&n.parent!==i?i.damageHull(e):n.type===V&&"wall"===i.type?n.damageHull(e,50):i.type===V&&"wall"===n.type&&i.damageHull(e,50)}(e,t)}))}function N(t,e,n,i,a){var o=t.game,h=o.physics,r=o.actors;h.timeStamp=a,r.cannonBalls.collection.forEach((function(e){return e.update(t)})),h.removeBodies.forEach((function(t){h.world.removeBody(t)})),h.world.step(e,n,i)}var W={create:function(){var t=Y.create.apply(Y,arguments);return t?t=Object.assign(t,this):null},makeMove:function(t,e){this.updateControls(t.keyDown,e.actors.cannonBalls),this.updateAngle(t.keyDown,e.actors.cannonBalls)},updateControls:function(t,e){this.isActive()&&(t.c&&this.fireStarboard(e),t.v&&this.firePort(e))},updateAngle:function(t){this.isActive()&&(t.up&&this.body.applyForceLocal([0,this.speed]),t.right?this.body.angularVelocity=1:t.left?this.body.angularVelocity=-1:this.body.angularVelocity=0)}},q={shipImageTile:93,cannonRange:192};var U={losTime:null,targetAngle:null,lineOfSight:!1,create:function(t,e,n,i){var a=t.game;if(!v(["object","object","number","number"],t,a,e,n))return null;var o=Y.create.apply(Y,arguments);return o?Object.assign(o,q,i,this):null},makeMove:function(t){var e=t.game,n=e.actors.playerShip,i=e.actors.cannonBalls,a=e.physics.timeStamp,o=e.aStarGraph;if(this.isActive())if(n.isActive()){var h,r,s,l,u={ship:n,angleToShip:m(this.body,n.body),distance:(h=this.body,r=n.body,s=r.position[0]-h.position[0],l=r.position[1]-h.position[1],Math.sqrt(s*s+l*l))};a>this.losTime+1&&(this.hasLineOfSight(t,u),this.losTime=a,this.path=window.path=null),this.lineOfSight||this.path&&this.path.length;var d,c=(d=this.getAngle(),(d%=2*Math.PI)<0&&(d+=2*Math.PI),d),p=w(c,u.angleToShip);this.body.angularVelocity=0,this.lineOfSight&&32*u.distance<192&&p>=0&&p<.24?(this.turnToBroadside(p),this.fireStarboard(i)):this.lineOfSight&&32*u.distance<192&&p>2.9&&p<3.5?(this.turnToBroadside(p),this.firePort(i)):this.lineOfSight&&32*u.distance<192?this.turnToBroadside(p):this.lineOfSight?this.followShip(u,c):this.path&&this.path.length?this.followCourseToShip(u,o,c):this.plotCourseToShip(u,o,c)}else this.body.angularVelocity=0},hasLineOfSight:function(t,e){var n=this,i=this.getX(),a=this.getY(),o=e.ship.getX(),h=e.ship.getY(),r=new p2.RaycastResult,s=new p2.Ray({mode:p2.Ray.ALL,from:[i,a],to:[o,h],callback:function(t){return n.rayCallback(t,e,s)}});t.game.physics.world.raycast(r,s)},rayCallback:function(t,e){if(this.body!==t.body){if(e.ship.body!==t.body)return t.body.parent&&"wall"===t.body.parent.type?(this.lineOfSight=!1,void t.stop()):void 0;this.lineOfSight=!0}},turnToBroadside:function(t){t>.01&&t<1.49?this.body.angularVelocity=1:t<-.01&&t>=-1.5?this.body.angularVelocity=-1:t>1.5&&t<3.1?this.body.angularVelocity=-1:t<-1.5&&t>-3.1&&(this.body.angularVelocity=1)},followShip:function(t,e){this.turnToward(e,t.angleToShip),this.body.applyForceLocal([0,this.speed])},turnToward:function(t,e){var n=w(t-a,e);Math.abs(n)<.01||(this.body.angularVelocity=n>0?1:-1)},followCourseToShip:function(t,e,n){var i=null;this.path&&this.path.length&&(this.findWayPoint(this.path),i=this.findDirectionFromPath(this.path)),i&&this.turnToward(n,i),this.body.applyForceLocal([0,20])},findWayPoint:function(t){var e=function(t,e){return t>=e&&t<=e+32},n=g(t[0][0],t[0][1]),i=g(this.getX(),this.getY());e(i.x,n.x)&&e(i.y,n.y)&&t.shift()},findDirectionFromPath:function(t){if(t.length){var e=g(t[0][0],t[0][1]),n=g(this.getX(),this.getY());return m({position:[n.x,n.y]},{position:[e.x,e.y]})}return null},plotCourseToShip:function(t,e){this.path=this.findPathToShip(t.ship,e),this.followCourseToShip.apply(this,arguments)},findPathToShip:function(t,e){var n=function(t,e){return t>=0&&t<e?t:Math.floor(e/2)},i=new PF.AStarFinder({turnPenalty:20,avoidStarcasing:!0,allowDiagonal:!0});return window.path=i.findPath(n(Math.floor(this.getX()),e.width),n(Math.floor(this.getY()),e.width),n(Math.floor(t.getX()),e.width),n(Math.floor(t.getY()),e.width),e.clone())}},z={create:function(){var t=Object.create(this);return t.vector=p2.vec2.fromValues(0,.1),t},getAngleDegrees:function(){return Math.atan2(this.vector[0],this.vector[1])*(180/Math.PI)},changeWind:function(){}},J={collection:null,create:function(t){var e=Object.create(this);return e.collection=[],e.pooledObject=t,e},add:function(){var t=null;this.isObjectReady()&&(t=this.collection.shift()).reset.apply(t,arguments),t||(t=this.pooledObject.create.apply(this.pooledObject,arguments)),this.collection.push(t)},isObjectReady:function(){return this.collection[0]&&!this.collection[0].isActive()},clean:function(){for(var t=0;t<this.collection.length&&!this.collection[t].isActive();t++);t>1&&this.collection.splice(0,t-1)}},K=[{},{},{shipImageTile:94,hull:800},{shipImageTile:96,cannonSpeed:400},{shipImageTile:96,cannonSpeed:400},{shipImageTile:96,cannonSpeed:400}];function Q(t){var e,n;do{e=c(0,t.length),n=c(0,t.length)}while(!f(t,e,n));return g(e,n)}function Z(t,e){var n=t.game,i=n.actors,a=i.playerShip.findRenderPoint();a&&(t.viewport.setX(32*a[0],t.width,4e3),t.viewport.setY(32*a[1],t.height,4e3)),t.uiElements.canvas.style="background-position-x: ".concat(d(t.viewport.x)%64,"px; background-position-y: ").concat(d(t.viewport.y)%64,"px;"),t.context.clearRect(0,0,t.width,t.height),function(t,e,n){t.context.beginPath();for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var o=e[i][a];if("number"==typeof o){var h=G(o),r=32*a,s=32*i;t.viewport.isInViewport(r,s,t.width,t.height)&&t.context.drawImage(n.sandTileSet,64*h[0],64*h[1],64,64,d(r+t.viewport.x)-16,d(s+t.viewport.y)-16,32,32)}}}(t,n.tileMapValues,t.assets),i.playerShip.draw(t,t.assets.pirateShips),i.enemyShips.forEach((function(e){e.draw(t,t.assets.pirateShips)})),i.cannonBalls.collection.forEach((function(e){return e.draw(t,t.assets)})),e&&(t.mapContext.beginPath(),t.mapContext.clearRect(0,0,t.mapWidth,t.mapHeight),function(t,e){t.save();for(var n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++){var a=e[n][i];if("number"==typeof a){var o=d(1*i),h=d(1*n);t.fillStyle=1===a?"#dbbe64":"#2a82a8",t.fillRect(o,h,1,1)}}t.restore()}(t.mapContext,n.map),H(t.mapContext,i.playerShip),i.enemyShips.forEach((function(e){H(t.mapContext,e)}))),Math.random()}var $=[{name:"sandTileSet",url:"./assets/image/tilesheet/tiles_sheet.png"},{name:"pirateShips",url:"./assets/image/spritesheet/shipsMiscellaneous_sheet.png"}];function tt(t){var e={};return t.forEach((function(t){e[t.name]=t.image})),e}var et,nt,it,at,ot,ht,rt,st,lt,ut,dt=(et=S(h),nt=et.seaSand.getContext("2d"),it=et.canvas.getContext("2d"),at=et.mapCanvas.getContext("2d"),ot=et.mapCanvas.height=125,ht=et.mapCanvas.width=125,rt=et.seaSand.height=et.canvas.height=window.innerHeight,st=et.seaSand.width=et.canvas.width=window.innerWidth,lt=T.create(),ut={keyDown:A,sfx:lt,uiElements:et,seaContext:nt,context:it,mapContext:at,mapHeight:ot,mapWidth:ht,height:rt,width:st,viewport:b},M(),O(ut),function(t){r(t.uiElements.helpPopup,"click",(function(e){switch(e.target){case t.uiElements.helpPopup:case t.uiElements.helpClose:t.uiElements.helpPopup.classList.toggle("hidden"),t.currentGame.run();break;case t.uiElements.startGameButton:t.uiElements.helpPopup.classList.toggle("hidden"),t.startGame()}}))}(ut),ut);function ct(){dt.game={physics:null,map:null,actors:null},_(dt),D(dt),function(t){var e=t.game,n=e.map,i=e.actors={},a=Q(n);i.playerShip=W.create(t,a.x,a.y),i.enemyShips=K.map((function(e){var i=Q(n);return U.create(t,i.x,i.y,e)})),i.cannonBalls=J.create(F),i.mapWind=z.create(t.compassArrow)}(dt),(dt.currentGame=j.create(dt,N,Z)).run()}dt.startGame=ct,function(t){return(e=$,Promise.all(e.map((function(t){return new Promise((function(e){var n=new Image;t.image=n,n.onload=function(){return e(t)},n.src=t.url}))})))).then(tt).then((function(e){t.assets=e}));var e}(dt).then(ct)}]);